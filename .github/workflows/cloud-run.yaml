name: ClOUD-RUN
on:
  workflow_dispatch:


permissions:
  id-token: write
  contents: read
  issues: write
  pull-requests: write

jobs:
  deploy_to_cloud_run:
    name: CLOUD-RUN-DEPLOY
    runs-on: ubuntu-latest
    steps:
      - name: Git Checkout
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 21
          cache: gradle

      - name: Install Dependencies
        run: ./gradlew build --no-daemon

      - name: Run Job
        run: |
          gcloud run deploy recommendations-job \
          --image asia-south1-docker.pkg.dev/architect-learning-435310/recommendations-engine/recommendations-pre-processor-job \
          --project ${{ secrets.PROJECT_ID }} \
          --platform managed \
          --region ${{ secrets.PROJECT_REGION }} \
          --args="${{ secrets.GCP_STORAGE_BUCKET_INPUT_PATH }}","${{ secrets.GCP_STORAGE_BUCKET_NAME }}"
      

